<main id="reservation_page">
  <section class="reservation-card block_white">
    <div class="reservation-header">
      <button class="btn btn-back" (click)="goBack()">‚Üê Revenir</button>
      <h2>Mes r√©servations</h2>
      <div class="header-stats">
        <span class="stat-badge">{{ reservations.length }} r√©servation(s)</span>
      </div>
    </div>

    <div *ngIf="reservations.length === 0" class="no-reservations">
      <div class="empty-icon">üìÖ</div>
      <h3>Aucune r√©servation</h3>
      <p>Vous n'avez pas encore de r√©servations. Allez r√©server un jeu !</p>
    </div>

    <div *ngIf="reservations.length > 0" class="table-container">
      <table class="reservation-table">
        <thead>
          <tr>
            <th class="col-id">ID</th>
            <th class="col-date">Date d√©but</th>
            <th class="col-date">Date fin</th>
            <th class="col-game">Jeu</th>
            <th class="col-table">Table</th>
            <th class="col-status">Statut</th>
            <th class="col-avis">Titre Avis</th>
            <th class="col-comment">Commentaire</th>
            <th class="col-rating">Note</th>
            <th class="col-action">Action</th>
          </tr>
        </thead>

        <tbody>
          <tr
            *ngFor="let r of reservations; let i = index"
            [class.odd]="i % 2 === 1"
            [class.highlight]="isReservationHighlighted(r)"
          >
            <td class="col-id">
              <span class="badge-id">{{ r.id }}</span>
            </td>

            <!-- Date D√©but -->
            <td class="col-date">
              <span class="date-badge">
                {{ r.datetimeDebut | date : 'dd/MM/yyyy' }}
              </span>
              <span class="time-badge">
                {{ r.datetimeDebut | date : 'HH:mm' }}
              </span>
            </td>

            <!-- Date Fin -->
            <td class="col-date">
              <span class="date-badge">
                {{ r.datetimeFin | date : 'dd/MM/yyyy' }}
              </span>
              <span class="time-badge">
                {{ r.datetimeFin | date : 'HH:mm' }}
              </span>
            </td>

            <!-- Jeu -->
            <td class="col-game">
              <span class="game-name">{{ r.jeu?.nom }}</span>
            </td>

            <!-- Table -->
            <td class="col-table">
              <span class="table-badge">{{ r.tableJeu?.nomTable }}</span>
            </td>

            <!-- Statut -->
            <td class="col-status">
              <span class="status-badge">
                {{ r.statutReservation }}
              </span>
            </td>

            <!-- Titre Avis -->
            <td class="col-avis">
              <input
                type="text"
                class="input-avis input-titre"
                [(ngModel)]="r.avis!.titre"
                placeholder="Titre..."
                [disabled]="!r.avisModifiable"
                maxlength="100"
              />
              <span class="char-count" *ngIf="r.avisModifiable">
                {{ (r.avis!.titre || '').length }}/100
              </span>
            </td>

            <!-- Commentaire -->
            <td class="col-comment">
              <textarea
                class="input-avis input-comment"
                [(ngModel)]="r.avis!.commentaire"
                placeholder="Partagez votre avis..."
                [disabled]="!r.avisModifiable"
                rows="2"
                maxlength="500"
              ></textarea>
              <span class="char-count" *ngIf="r.avisModifiable">
                {{ (r.avis!.commentaire || '').length }}/500
              </span>
            </td>

            <!-- Note (√âtoiles) -->
            <td class="col-rating">
              <div
                class="note-etoiles"
                [class.disabled]="!r.avisModifiable"
                [title]="r.avisModifiable ? 'Cliquez pour noter' : 'Non modifiable'"
              >
                <span
                  *ngFor="let star of [1, 2, 3, 4, 5]"
                  (click)="setRating(r, star)"
                  [class.active]="r.avis!.note >= star"
                  [class.hover]="!r.avisModifiable"
                  class="star"
                >
                  ‚òÖ
                </span>
              </div>
              <span class="rating-text" *ngIf="r.avis!.note > 0"> {{ r.avis!.note }}/5 </span>
              <!-- Note en √©toiles -->
            </td>

            <td class="col-action">
              <button
                class="btn btn-validate"
                (click)="saveAvis(r)"
                *ngIf="r.avisModifiable"
                title="Valider et enregistrer l'avis"
              >
                ‚úÖ Valider
              </button>
              <span class="status-icon" *ngIf="!r.avisModifiable" title="Avis valid√©">
                ‚úîÔ∏è Valid√©
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</main>
